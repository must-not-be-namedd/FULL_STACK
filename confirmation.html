<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Successful!</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles - Copied from device-selection-ui */
        :root {
            --dark-bg: #1A1A2E; /* Very dark blue/purple */
            --form-bg-start: #2A2A4A; /* Slightly lighter for gradient start */
            --form-bg-end: #1A1A2E; /* Darker for gradient end */
            --button-gradient-start: #6A0DAD; /* Vibrant purple */
            --button-gradient-end: #4A0080; /* Deeper purple */
            --text-light: #E0E0E0;
            --text-white: #FFFFFF;
            --border-color: #444466; /* Subtle blue-grey border */
            --input-bg: #1D1D3A; /* Darker input background */
            --shadow-color-light: rgba(0, 0, 0, 0.4);
            --shadow-color-dark: rgba(0, 0, 0, 0.8);
            --link-color: #76a9ff; /* Original link color, still fits */
            --link-hover-color: #a3c4ff;
            --popup-bg: #3A3A5A; /* Slightly lighter than dark-bg for popup */
            --popup-border: #6A0DAD; /* Border color for popup */
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark-bg);
            color: var(--text-light);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(circle at top left, #2F2F50 0%, transparent 50%),
                              radial-gradient(circle at bottom right, #1A1A2E 0%, transparent 50%);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding-top: 40px;
            padding-bottom: 40px;
            overflow-x: hidden;
        }

        /* Headings and Paragraphs */
        h1, h3, p {
            text-align: center;
            color: var(--text-white);
            margin-bottom: 15px;
            font-weight: 700;
            font-size: 1.8rem;
            letter-spacing: 0.5px;
        }

        h1 {
            overflow: hidden;
            white-space: nowrap;
            margin: 0 auto;
            border-right: .15em solid orange;
            animation: 
                typing 3.5s steps(20, end) forwards, /* Adjusted steps for "Payment Successful!" */
                blink-caret .75s step-end infinite;
            width: 0;
            max-width: 100%;
            padding-right: 5px;
            margin-bottom: 25px; /* Added margin below h1 */
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 25px;
            margin-bottom: 15px;
            color: var(--button-gradient-start); /* Purple color for subheadings */
            opacity: 0;
            animation: fadeIn 1s ease-in-out 4s forwards; /* Staggered animation */
        }

        p {
            font-size: 1.1rem;
            color: var(--text-light);
            line-height: 1.6;
            opacity: 0;
            animation: fadeIn 1s ease-in-out 3.5s forwards; /* Staggered animation */
        }

        /* Container for content */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90%;
            max-width: 600px;
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(145deg, var(--form-bg-start) 0%, var(--form-bg-end) 100%);
            border-radius: 18px;
            box-shadow: 0 10px 25px var(--shadow-color-dark);
            border: 1px solid var(--border-color);
            opacity: 0; /* Initially hide the container */
            animation: fadeIn 1s ease-in-out 3.8s forwards; /* Fade in after initial paragraph */
        }

        .container p span {
            font-weight: 600;
            color: var(--text-white);
        }

        /* Ticket Section */
        #ticket {
            margin-top: 30px;
            padding: 25px;
            background-color: rgba(30, 30, 48, 0.7);
            border-radius: 15px;
            box-shadow: 0 5px 15px var(--shadow-color-dark);
            width: 90%;
            max-width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--border-color);
            opacity: 0;
            animation: fadeIn 1s ease-in-out 4.5s forwards; /* Staggered animation */
        }

        #ticket h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--button-gradient-start);
            font-size: 1.4rem;
        }

        /* QR Code Styling (for the image) */
        #qr-code-image {
            padding: 10px;
            background-color: var(--text-white); /* White background for QR code */
            border-radius: 8px;
            display: inline-block; /* To center the QR code image */
            box-shadow: 0 2px 8px var(--shadow-color-light);
            margin: 0 auto; /* Center the QR code */
            width: 128px; /* Ensure consistent size */
            height: 128px; /* Ensure consistent size */
            object-fit: contain; /* Ensure the image fits within the bounds */
        }

        /* Footer */
        footer {
            margin-top: 40px;
            color: #888;
            font-size: 15px;
            text-align: center;
            padding: 15px;
            letter-spacing: 0.3px;
            opacity: 0;
            animation: fadeIn 1s ease-in-out 5s forwards; /* Staggered animation */
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 300px } /* Adjusted width for "Payment Successful!" */
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: orange }
        }

        /* ===================== */
        /* ðŸ“£ Popup Styles */
        /* ===================== */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark semi-transparent overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .popup-content {
            background: linear-gradient(145deg, var(--popup-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-white);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-color-dark);
            max-width: 450px;
            text-align: center;
            position: relative;
            border: 2px solid var(--popup-border);
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .popup-overlay.show .popup-content {
            transform: scale(1);
            opacity: 1;
        }

        .popup-content h4 {
            color: var(--button-gradient-start);
            font-size: 1.6rem;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .popup-content p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            color: var(--text-light);
            opacity: 1; /* Override parent p opacity animation */
            animation: none; /* Disable default p animation */
        }

        .popup-close-btn {
            background: linear-gradient(90deg, var(--button-gradient-start) 0%, var(--button-gradient-end) 100%);
            color: var(--text-white);
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        .popup-close-btn:hover {
            background: linear-gradient(90deg, var(--button-gradient-end) 0%, var(--button-gradient-start) 100%);
            transform: translateY(-2px);
        }

        /* ===================== */
        /* ðŸ“± Responsive Styling */
        /* ===================== */

        @media (max-width: 768px) {
            h1 {
                font-size: 1.6rem;
                animation: 
                    typing 3.5s steps(18, end) forwards,
                    blink-caret .75s step-end infinite;
            }
            h3 {
                font-size: 1.3rem;
            }
            p {
                font-size: 1rem;
            }
            .container {
                padding: 25px;
                border-radius: 15px;
            }
            #ticket {
                padding: 20px;
                border-radius: 12px;
            }
            footer {
                font-size: 14px;
            }
            .popup-content {
                max-width: 90%;
                padding: 25px;
            }
            .popup-content h4 {
                font-size: 1.4rem;
            }
            .popup-content p {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 20px;
                padding-bottom: 20px;
            }
            h1 {
                font-size: 1.4rem;
                margin-bottom: 10px;
                animation: 
                    typing 3.5s steps(16, end) forwards,
                    blink-caret .75s step-end infinite;
            }
            h3 {
                font-size: 1.2rem;
            }
            p {
                font-size: 0.95rem;
            }
            .container {
                width: 95%;
                padding: 20px;
                border-radius: 12px;
                margin-top: 20px;
            }
            #ticket {
                padding: 15px;
                border-radius: 10px;
            }
            footer {
                font-size: 13px;
                margin-top: 20px;
            }
            .popup-content {
                padding: 20px;
            }
            .popup-content h4 {
                font-size: 1.2rem;
            }
            .popup-content p {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Payment Successful!</h1>
        
        <p>Thank you for your booking. Here are your details:</p>

        <h3>Booking Details</h3>
        <p>Locker Location: <span id="locker-location">N/A</span></p>
        <p>Devices Rented: <span id="device-list">N/A</span></p>
        <p>Total Payment: â‚¹<span id="total-payment">0</span></p>

        <div id="ticket">
            <h3>Your Ticket</h3>
            <img id="qr-code-image" src="qr.png" alt="QR Code" onerror="this.src='https://placehold.co/128x128/FFFFFF/000000?text=QR+Error';">
            <p style="font-size: 0.9rem; margin-top: 15px; color: #aaa; font-style: italic; text-align: center;">Scan this QR code at the locker to access your devices.</p>
        </div>

    </div>

    <footer>&copy; 2024 Locker Booking Service | Powered by GPS & Metro Stations</footer>

    <div id="infoPopup" class="popup-overlay">
        <div class="popup-content">
            <h4>Important Information</h4>
            <p>
                To collect your rented devices, kindly proceed to the designated counter at the metro station or bus stop to complete your payment. Upon successful payment, please scan the provided QR code at the locker for immediate access to your items.
            </p>
            <button class="popup-close-btn">Understood</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Define a list of random Bangalore locations
            const bangaloreLocations = [
                "Majestic Metro Station",
                "Indiranagar Metro Station",
                "MG Road Metro Station",
                "Jayanagar 4th Block Bus Stop",
                "Koramangala 80 Feet Road",
                "Electronic City Phase 1",
                "Whitefield Forum Mall",
                "Banashankari Bus Stand",
                "Shivajinagar Bus Station",
                "Cubbon Park Metro Station"
            ];

            // Get a random location from the list
            const randomLockerLocation = bangaloreLocations[Math.floor(Math.random() * bangaloreLocations.length)];
            
            // Retrieve booking details from localStorage
            const rentedItems = JSON.parse(localStorage.getItem('selectedDevices'));
            const totalAmount = localStorage.getItem('totalAmount'); // This is already in INR

            // Populate the booking details on the confirmation page
            document.getElementById('locker-location').textContent = randomLockerLocation;
            
            if (rentedItems && rentedItems.length > 0) {
                // Format the rented items for display (e.g., "Power Bank (2), Headphones (1)")
                const formattedRentedItems = rentedItems.map(item => `${item.name} (${item.quantity})`).join(', ');
                document.getElementById('device-list').textContent = formattedRentedItems;
            } else {
                document.getElementById('device-list').textContent = 'No devices selected.';
            }
            
            document.getElementById('total-payment').textContent = totalAmount || '0.00';

            // Set the src of the QR code image.
            const qrCodeImageElement = document.getElementById("qr-code-image");
            qrCodeImageElement.src = 'qr.png'; 
            qrCodeImageElement.alt = `QR Code for Locker: ${randomLockerLocation}, Devices: ${rentedItems ? rentedItems.map(item => item.name).join(', ') : 'None'}, Total: â‚¹${totalAmount || '0.00'}`;

            // --- Popup Logic ---
            const popupOverlay = document.getElementById('infoPopup');
            const closeButton = popupOverlay.querySelector('.popup-close-btn');

            setTimeout(() => {
                popupOverlay.classList.add('show');
            }, 4000); // Show popup after 4 seconds

            closeButton.addEventListener('click', () => {
                popupOverlay.classList.remove('show');
            });

            // Optional: Close popup if clicking outside (on the overlay itself)
            popupOverlay.addEventListener('click', (event) => {
                if (event.target === popupOverlay) {
                    popupOverlay.classList.remove('show');
                }
            });
        };
    </script>
</body>
</html>
